$(document).ready(function(){function e(e=l.LIGHT){let o=e;e===l.SYSTEM&&(o=t()),$("html").attr("data-theme",o),n("theme",e,7),n("system_theme",o,1)}function t(){return window.matchMedia("(prefers-color-scheme: dark)").matches?l.DARK:l.LIGHT}function n(e,t,n){const o=new Date;o.setTime(o.getTime()+24*n*60*60*1e3),document.cookie=`${e}=${t}; expires=${o.toUTCString()}; path=/`}function o(e){$(".theme-toggle button").removeClass("active"),e.addClass("active")}function a(){const e=i("theme")||l.LIGHT;let t;t=e===l.LIGHT?$('.theme-toggle button[title="浅色模式"]'):e===l.DARK?$('.theme-toggle button[title="深色模式"]'):e===l.SYSTEM?$('.theme-toggle button[title="跟随系统"]'):$('.theme-toggle button[title="浅色模式"]'),o(t)}function i(e){const t=document.cookie.split(";");for(let n of t){const[t,o]=n.trim().split("=");if(t===e)return o}return null}function s(e,t){return function(){$(this).addClass(e).removeClass(t)}}function c(e,t){$(e).each(function(e){var n=e*t+"s";$(this).css("animation-delay",n)})}const r=(e,t)=>{let n=null;return function(){n||(n=setTimeout(()=>{e.apply(this,arguments),n=null},t))}};$("#nav-backtop").click(function(){return $("html, body").animate({scrollTop:0},200),!1});const l={LIGHT:"light",DARK:"dark",SYSTEM:"system"};$(".theme-toggle").on("click","button",function(){const t=$(this).attr("title");switch(t){case"浅色模式":e(l.LIGHT);break;case"深色模式":e(l.DARK);break;case"跟随系统":e(l.SYSTEM)}o($(this))}),a(),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{e(l.SYSTEM)});const d=()=>{const e=$(window).scrollTop(),t=$(document).height(),n=$(window).height(),o=Math.round(e/(t-n)*100);o>0?($("#nav-backtop").toggleClass("top-to-active",o>=90),$(".back-to-top").show(),$("#nav-backtop>.top-to-text").text(o>=90?"回到顶部":o)):$(".back-to-top").hide()};let m=!1;$("#navbar").hasClass("nav-ui-one")&&(m=!0),toggleNavOnScroll=((e,t,n,o=100)=>{if(m)return;const a=$(e),i=$(this).scrollTop();i>o?a.hasClass(n)&&a.removeClass(n).addClass(t):a.hasClass(t)&&a.removeClass(t).addClass(n)}),d(),toggleNavOnScroll("#navbar","nav-ui-one","nav-ui-two",100),$(window).scroll(function(){r(d(),100),r(toggleNavOnScroll("#navbar","nav-ui-one","nav-ui-two",50),100)});let u=0,h=0,p=!1;$("#menu-line").click(function(e){e.stopPropagation();const t=$("#nav-components");if(t.length)return void v();const n=$("#mobile-nav");n.append('<div id="mobile-nav-bg" class="header-overlay-card"></div>');const o=$(".nav-inner > ul").clone();o.find(".sub-menu").addClass("mt-1"),o.find(".sub-menu>ul").addClass("row p-1 ml-2"),o.find(".sub-menu>ul>li").addClass("col-4 p-1"),o.find(".nav-item").addClass("pb-3"),o.find(".nav-item>.nav-a").addClass("font-weight-bold"),o.find(".nav-item>.nav-a").prepend('<i class="iconfont icon-xingqiu font-weight-normal mr-1"></i>'),n.append(`<div id="nav-components" class="mobile-aside px-3 py-2"><div class="mx-auto"><i class="back-box mb-2"></i></div>${o.prop("outerHTML")}</div>`),requestAnimationFrame(()=>{$("#mobile-nav-bg").css({opacity:"1",visibility:"visible"}),$("#nav-components").addClass("open")}),$("body").css("overflow","hidden")}),$(document).click(function(e){!$("#nav-components").hasClass("open")||$(e.target).closest("#nav-components").length||$(e.target).closest("#menu-line").length||v()}),$("#nav-components").click(function(e){e.stopPropagation()}),$(document).on("touchstart",function(e){$("#nav-components").hasClass("open")&&(u=e.originalEvent.touches[0].pageY,h=u,p=!0)}),$(document).on("touchmove",function(e){if(p){h=e.originalEvent.touches[0].pageY;const t=h-u;t>0&&$("#nav-components").css("transform",`translateY(${t}px)`)}}),$(document).on("touchend",function(){if(p){const e=h-u,t=$("#nav-components").height()/2;e>t?v():$("#nav-components").css("transform",""),p=!1}});const v=()=>{const e=$("#nav-components"),t=$("#mobile-nav-bg");e.removeClass("open"),t.css({opacity:0,visibility:"hidden"}),e.one("transitionend",function(){e.remove(),t.remove(),$("body").css("overflow","")})};$("#search-btn").click(function(){$(".main-search").addClass("open")}),$(".search-box").on("click","#search-close-btn",function(){$(".main-search").removeClass("open")});const f=(e,t,n)=>$('<div class="main-'+e+'"><div class="header-overlay-card"></div><div class="'+e+'-box card p-4 no-animation">'+t+'<div id="'+n+'" class="close-btn"><i class="iconfont icon-guanbi"></i></div></div></div>'),g=(e,t)=>{0===$(e).length&&$("body").append(t()),requestAnimationFrame(()=>{$(e).addClass("open")})},b=e=>{e.removeClass("open"),setTimeout(function(){e.remove()},500)};$(document).on("click",".close-btn",function(){const e=$(this).closest(".main-reward, .main-share");b(e)}),$(document).click(function(e){const t=$(e.target);!t.closest(".search-box, #search-btn").length&&$(".search-box").is(":visible")&&$(".main-search").removeClass("open"),!t.closest(".reward-box, #reward-btn").length&&$(".reward-box").is(":visible")&&b($(".main-reward")),!t.closest(".share-box, #share-btn").length&&$(".share-box").is(":visible")&&b($(".main-share"))}),$(document).click(function(e){e.stopPropagation()});const w=()=>f("reward",'<div class="reward-content d-flex justify-content-center"><div class="reward-qr d-flex flex-column align-items-center"><img src="'+decodeURIComponent(_WXQR)+'" /><span>微信</span></div><div class="reward-qr d-flex flex-column align-items-center"><img src="'+decodeURIComponent(_ZFBQR)+'" /><span>支付宝</span></div></div>',"reward-close-btn");$("#reward-btn").click(function(){g(".main-reward",w)});const C={qq:"http://connect.qq.com/widget/shareqq/index.html?url=",weibo:"http://service.weibo.com/share/share.php?url=",twitter:"https://twitter.com/intent/tweet?url=",wechat:"javascript:void(0);"},y=()=>f("share",'<p class="p-2">'+decodeURIComponent(_ARTICLE_URL)+'</p><div class="share-a d-flex flex-row justify-content-center"><a class="share-item d-flex align-items-center justify-content-center" href="'+C.qq+decodeURIComponent(_ARTICLE_URL)+"&title="+decodeURIComponent(_ARTICLE_NAME)+'"><i class="iconfont icon-qq"></i></a><a class="share-item d-flex align-items-center justify-content-center" href="'+C.weibo+decodeURIComponent(_ARTICLE_URL)+"&title="+decodeURIComponent(_ARTICLE_NAME)+'"><i class="iconfont icon-weibo"></i></a><a class="share-item d-flex align-items-center justify-content-center" href="'+C.twitter+decodeURIComponent(_ARTICLE_URL)+"&text="+decodeURIComponent(_ARTICLE_NAME)+'"><i class="iconfont icon-tuite"></i></a><a id="share-wechat" class="share-item d-flex align-items-center justify-content-center" href="'+C.wechat+'"><i class="iconfont icon-pengyouquan"></i></a></div>',"share-close-btn");$("#share-btn").click(function(){g(".main-share",y)}),$(document).on("click","#share-wechat",function(){0===$(".wechat-qrcode").length?$(".share-box").append('<div class="wechat-qrcode text-center my-4"><img src="//api.qrserver.com/v1/create-qr-code/?size=200x200&margin=10&data='+encodeURIComponent(_ARTICLE_URL)+'" title="'+encodeURIComponent(_ARTICLE_NAME)+'"><div class="mt-2">微信扫码分享</div></div>'):$(".wechat-qrcode").remove()});const x=e=>{const t=$.extend({duration:1500,easing:e=>e*(2-e),format:e=>e.toLocaleString()},e),n=$(t.selector);if(!n.length)return void console.error("元素未找到:",t.selector);let o=null;const a=t.end-t.start,i=Math.abs(a)>1e4,s=e=>{o=o||e;const c=e-o,r=Math.min(c/t.duration,1),l=t.easing(r);let d=t.start+a*l;if(i){const e=t.end-d;d=Math.abs(e)>1e3?t.end-e*(1+Math.random()/3):d}n.text(t.format(Math.floor(d))),r<1?requestAnimationFrame(s):n.text(t.format(t.end))};requestAnimationFrame(s)};var I={effect:"fadeIn",threshold:200,container:window,failure_limit:30};if($("img.lazy").lazyload($.extend({},I,{load:s("loaded","lazy")})),$(".hh-widget img.widget-lazy").lazyload($.extend({},I,{load:s("loaded","widget-lazy")})),c(".nav-menu>.nav-item",.15),c(".hh-widget:not(.no-animation)",.3),c(".card:not(.no-animation)",.3),c(".links-card",.3),"undefined"!=typeof Swiper){var R=new Swiper(".swiper-container",{direction:"horizontal",loop:!0,autoplay:5e3,speed:1e3,autoplayDisableOnInteraction:!1,pagination:".swiper-pagination",paginationClickable:!0,prevButton:".swiper-button-prev",nextButton:".swiper-button-next",roundLengths:!0,parallax:!0,lazyLoading:!0});$(".swiper-container").mouseenter(function(){R.stopAutoplay()}).mouseleave(function(){R.startAutoplay()}),$(".swiper-container").hover(function(){R.stopAutoplay()},function(){R.startAutoplay()})}if("undefined"!=typeof ViewImage&&window.ViewImage&&ViewImage.init(".post-content img[show-img],.comment-list img"),showSvg(),$(".timejourney-progress").length>0){var T=$(".timejourney-progress").data("percentage");const e=T||0;$(".timejourney-progress").css({width:e+"%",transition:"width "+(e/10+1)+"s ease-in-out"}),x({start:0,end:e,duration:e/10*1e3+1500,selector:"#timejourney-progress",format:e=>`${e}%`})}});